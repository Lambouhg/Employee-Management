<div class="flex h-screen overflow-hidden">
  <app-navbar 
    [currentUser]="currentUser" 
    [menuItems]="menuItems"
    [activeRoute]="'/manager/employees'">
  </app-navbar>

  <div class="flex-1 flex flex-col bg-white">
    <!-- Header -->
    <div class="border-b border-gray-200 px-8 py-6">
      <div class="flex items-center justify-between mb-6">
        <div>
          <h1 class="text-2xl font-semibold text-gray-900">People</h1>
          <p class="text-sm text-gray-500 mt-1">Manage and collaborate within your organization's teams</p>
        </div>
        <button class="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors flex items-center gap-2" (click)="openEmployeeForm()">
          <i-lucide [img]="Plus" class="w-4 h-4"></i-lucide>
          <span>Add member</span>
        </button>
      </div>

      <!-- Tabs -->
      <div class="flex gap-6 border-b border-gray-200 -mb-px">
        <button 
          *ngFor="let tab of tabs"
          (click)="onTabChange(tab.id)"
          [class]="activeTab === tab.id 
            ? 'pb-3 border-b-2 border-indigo-600 text-indigo-600 font-medium' 
            : 'pb-3 text-gray-500 hover:text-gray-700'">
          {{ tab.label }}
        </button>
      </div>
    </div>

    <!-- Toolbar -->
    <div class="px-8 py-4 border-b border-gray-200 flex items-center gap-4">
      <!-- Search -->
      <div class="flex-1 relative">
        <i-lucide [img]="Search" class="w-5 h-5 absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i-lucide>
        <input 
          type="text" 
          placeholder="Search by name or email" 
          [(ngModel)]="searchText"
          (keyup.enter)="onSearch()"
          class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
      </div>

      <!-- Search Button -->
      <button 
        (click)="onSearch()"
        class="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 flex items-center gap-2">
        <i-lucide [img]="Search" class="w-4 h-4"></i-lucide>
        <span>Search</span>
      </button>

      <!-- Filters -->
      <button class="px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 flex items-center gap-2">
        <i-lucide [img]="Filter" class="w-4 h-4"></i-lucide>
        <span>Filters</span>
      </button>

      <!-- Sort -->
      <button class="px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 flex items-center gap-2">
        <i-lucide [img]="ArrowUpDown" class="w-4 h-4"></i-lucide>
        <span>Sort by</span>
      </button>
    </div>

    <!-- Table -->
    <div class="flex-1 overflow-auto px-8">
      <!-- Loading State -->
      <div *ngIf="isLoading" class="text-center py-12">
        <div class="inline-block animate-spin rounded-full h-12 w-12 border-4 border-gray-200 border-t-indigo-600"></div>
        <p class="text-gray-500 mt-4">Đang tải...</p>
      </div>

      <!-- Error State -->
      <div *ngIf="error && !isLoading" class="text-center py-12">
        <p class="text-red-500">{{ error }}</p>
        <button (click)="loadEmployees()" class="mt-4 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700">
          Thử lại
        </button>
      </div>

      <!-- Table Content -->
      <div *ngIf="!isLoading && !error">
        <table class="w-full">
          <thead class="sticky top-0 bg-white border-b border-gray-200">
            <tr class="text-left">
              <th class="py-3 px-4 text-xs font-medium text-gray-500 uppercase tracking-wider">
                <input type="checkbox" class="rounded border-gray-300">
              </th>
              <th class="py-3 px-4 text-xs font-medium text-gray-500 uppercase tracking-wider">Name</th>
              <th class="py-3 px-4 text-xs font-medium text-gray-500 uppercase tracking-wider">Department</th>
              <th class="py-3 px-4 text-xs font-medium text-gray-500 uppercase tracking-wider">Role</th>
              <th class="py-3 px-4 text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
              <th class="py-3 px-4 text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
              <th class="py-3 px-4 text-xs font-medium text-gray-500 uppercase tracking-wider">Employment Type</th>
              <th class="py-3 px-4 text-xs font-medium text-gray-500 uppercase tracking-wider text-right">Actions</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-gray-200">
            <tr *ngFor="let employee of employees" class="hover:bg-gray-50">
              <td class="py-4 px-4">
                <input type="checkbox" class="rounded border-gray-300">
              </td>
              <td class="py-4 px-4">
                <div class="flex items-center gap-3">
                  <div class="w-10 h-10 rounded-full bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center text-white font-semibold">
                    {{ getInitials(employee.fullName) }}
                  </div>
                  <div>
                    <div class="font-medium text-gray-900">{{ employee.fullName }}</div>
                    <div class="text-sm text-gray-500">{{ employee.email }}</div>
                  </div>
                </div>
              </td>
              <td class="py-4 px-4">
                <div *ngIf="employee.department" class="flex items-center gap-2">
                  <span class="px-2 py-1 text-xs font-medium rounded-full bg-blue-100 text-blue-700">
                    {{ employee.department.code }}
                  </span>
                  <span class="text-sm text-gray-600">{{ employee.department.name }}</span>
                </div>
                <span *ngIf="!employee.department" class="text-sm text-gray-400">N/A</span>
              </td>
              <td class="py-4 px-4">
                <div class="flex items-center gap-2">
                  <span class="px-2 py-1 text-xs font-medium rounded-full" 
                    [ngClass]="{
                      'bg-purple-100 text-purple-700': employee.role.level === 3,
                      'bg-indigo-100 text-indigo-700': employee.role.level === 2,
                      'bg-gray-100 text-gray-700': employee.role.level === 1
                    }">
                    {{ employee.role.displayName }}
                  </span>
                </div>
              </td>
              <td class="py-4 px-4">
                <span class="px-2 py-1 text-xs font-medium rounded-full" 
                  [ngClass]="employee.isActive ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'">
                  {{ employee.isActive ? 'Active' : 'Inactive' }}
                </span>
              </td>
              <td class="py-4 px-4 text-sm text-gray-900">{{ formatDate(employee.createdAt) }}</td>
              <td class="py-4 px-4 text-sm text-gray-900">{{ formatEmploymentType(employee.employmentType) }}</td>
              <td class="py-4 px-4">
                <div class="flex items-center justify-end gap-2">
                  <button 
                    (click)="toggleEmployeeStatus(employee)"
                    class="p-2 hover:bg-gray-100 rounded-lg"
                    [title]="employee.isActive ? 'Deactivate' : 'Activate'">
                    <i-lucide [img]="employee.isActive ? UserX : UserCheck" 
                      class="w-4 h-4"
                      [ngClass]="employee.isActive ? 'text-red-500' : 'text-green-500'"></i-lucide>
                  </button>
                  <button 
                    (click)="resetPassword(employee)"
                    class="p-2 hover:bg-gray-100 rounded-lg"
                    title="Reset Password">
                    <i-lucide [img]="RefreshCw" class="w-4 h-4 text-blue-500"></i-lucide>
                  </button>
                  <button 
                    (click)="openEmployeeForm(employee.id)"
                    class="p-2 hover:bg-gray-100 rounded-lg"
                    title="Edit">
                    <i-lucide [img]="Edit" class="w-4 h-4 text-gray-600"></i-lucide>
                  </button>
                  <button 
                    (click)="deleteEmployee(employee.id)"
                    class="p-2 hover:bg-gray-100 rounded-lg"
                    title="Delete">
                    <i-lucide [img]="Trash2" class="w-4 h-4 text-red-500"></i-lucide>
                  </button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>

        <!-- Empty State -->
        <div *ngIf="employees.length === 0" class="text-center py-12">
          <i-lucide [img]="Users" class="w-12 h-12 text-gray-400 mx-auto mb-3"></i-lucide>
          <p class="text-gray-500">No employees found</p>
        </div>

        <!-- Pagination -->
        <div *ngIf="employees.length > 0" class="flex items-center justify-between py-4 border-t border-gray-200 mt-4">
          <div class="text-sm text-gray-500">
            Showing {{ (currentPage - 1) * pageSize + 1 }} to {{ Math.min(currentPage * pageSize, totalEmployees) }} of {{ totalEmployees }} employees
          </div>
          <div class="flex gap-2">
            <button 
              (click)="onPageChange(currentPage - 1)"
              [disabled]="currentPage === 1"
              class="px-3 py-1 border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed">
              Previous
            </button>
            <button 
              *ngFor="let page of [].constructor(totalPages); let i = index"
              (click)="onPageChange(i + 1)"
              [class]="(i + 1) === currentPage 
                ? 'px-3 py-1 bg-indigo-600 text-white rounded-lg' 
                : 'px-3 py-1 border border-gray-300 rounded-lg hover:bg-gray-50'">
              {{ i + 1 }}
            </button>
            <button 
              (click)="onPageChange(currentPage + 1)"
              [disabled]="currentPage === totalPages"
              class="px-3 py-1 border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed">
              Next
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Employee Form Modal -->
<app-employee-form-modal
  *ngIf="showEmployeeForm"
  [employeeId]="selectedEmployeeId"
  (closed)="closeEmployeeForm()"
  (saved)="onEmployeeSaved()">
</app-employee-form-modal>
