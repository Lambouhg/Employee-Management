<div class="fixed inset-0 bg-black/30 backdrop-blur-sm flex items-center justify-center z-50 animate-fadeIn" (click)="onClose()">
      <div class="bg-white rounded-xl shadow-2xl max-w-3xl w-full mx-4 max-h-[85vh] overflow-hidden animate-slideUp" (click)="$event.stopPropagation()">
        <!-- Header -->
        <div class="flex items-center justify-between px-6 py-5 border-b border-gray-200 bg-gradient-to-r from-indigo-50 to-purple-50">
          <div>
            <h2 class="text-xl font-semibold text-gray-900">
              {{ isEditMode ? 'Edit Employee' : 'Add New Employee' }}
            </h2>
            <p class="text-sm text-gray-500 mt-0.5">
              {{ isEditMode ? 'Update employee information' : 'Fill in the details to add a new team member' }}
            </p>
          </div>
          <button (click)="onClose()" class="p-2 hover:bg-white rounded-lg transition-colors">
            <i-lucide [img]="X" class="w-5 h-5 text-gray-500"></i-lucide>
          </button>
        </div>

        <!-- Form -->
        <form [formGroup]="employeeForm" (ngSubmit)="onSubmit()" class="p-6 overflow-y-auto max-h-[calc(85vh-170px)]">
          <div class="grid grid-cols-2 gap-4">
            <!-- Full Name -->
            <div class="col-span-2">
              <label class="block text-sm font-medium text-gray-700 mb-2">
                Full Name <span class="text-red-500">*</span>
              </label>
              <input
                type="text"
                formControlName="fullName"
                class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all"
                placeholder="Enter full name">
              <p *ngIf="employeeForm.get('fullName')?.invalid && employeeForm.get('fullName')?.touched" 
                class="text-red-500 text-xs mt-1">
                Full name is required
              </p>
            </div>

            <!-- Email -->
            <div class="col-span-2">
              <label class="block text-sm font-medium text-gray-700 mb-2">
                Email <span class="text-red-500">*</span>
              </label>
              <input
                type="email"
                formControlName="email"
                class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all"
                placeholder="email@company.com">
              <p *ngIf="employeeForm.get('email')?.invalid && employeeForm.get('email')?.touched" 
                class="text-red-500 text-xs mt-1">
                Valid email is required
              </p>
            </div>

            <!-- Password (only for create) -->
            <div *ngIf="!isEditMode" class="col-span-2">
              <label class="block text-sm font-medium text-gray-700 mb-2">
                Password <span class="text-red-500">*</span>
              </label>
              <input
                type="password"
                formControlName="password"
                class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all"
                placeholder="Enter password">
              <p *ngIf="employeeForm.get('password')?.invalid && employeeForm.get('password')?.touched" 
                class="text-red-500 text-xs mt-1">
                Password is required (min 6 characters)
              </p>
            </div>

            <!-- Phone -->
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">Phone</label>
              <input
                type="text"
                formControlName="phone"
                class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all"
                placeholder="0123456789">
            </div>

            <!-- Role -->
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">
                Role <span class="text-red-500">*</span>
              </label>
              <select
                formControlName="roleId"
                class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all bg-white">
                <option value="">Select role</option>
                <option *ngFor="let role of roles" [value]="role.id">
                  {{ role.displayName }} (Level {{ role.level }})
                </option>
              </select>
              <p *ngIf="employeeForm.get('roleId')?.invalid && employeeForm.get('roleId')?.touched" 
                class="text-red-500 text-xs mt-1">
                Role is required
              </p>
            </div>

            <!-- Department -->
            <div class="col-span-2">
              <label class="block text-sm font-medium text-gray-700 mb-2">
                Department
              </label>
              <select
                formControlName="departmentId"
                class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all bg-white">
                <option value="">No department</option>
                <option *ngFor="let dept of departments" [value]="dept.id">
                  {{ dept.name }} ({{ dept.code }})
                  <ng-container *ngIf="dept.manager">
                    - Manager: {{ dept.manager.fullName }}
                  </ng-container>
                </option>
              </select>
              <p class="text-xs text-gray-500 mt-1">
                <i-lucide [img]="Info" class="w-3 h-3 inline mr-1"></i-lucide>
                Manager will be automatically assigned from the selected department
              </p>
            </div>

            <!-- Employment Type -->
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">
                Employment Type <span class="text-red-500">*</span>
              </label>
              <select
                formControlName="employmentType"
                class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all bg-white">
                <option value="FULL_TIME">Full Time</option>
                <option value="PART_TIME">Part Time</option>
              </select>
            </div>

            <!-- Fixed Day Off -->
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">Fixed Day Off</label>
              <select
                formControlName="fixedDayOff"
                class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all bg-white">
                <option value="">None</option>
                <option value="MONDAY">Monday</option>
                <option value="TUESDAY">Tuesday</option>
                <option value="WEDNESDAY">Wednesday</option>
                <option value="THURSDAY">Thursday</option>
                <option value="FRIDAY">Friday</option>
                <option value="SATURDAY">Saturday</option>
                <option value="SUNDAY">Sunday</option>
              </select>
            </div>

            <!-- Is Active (only for edit) -->
            <div *ngIf="isEditMode" class="col-span-2">
              <label class="flex items-center gap-2">
                <input
                  type="checkbox"
                  formControlName="isActive"
                  class="rounded border-gray-300">
                <span class="text-sm font-medium text-gray-700">Active</span>
              </label>
            </div>
          </div>

          <!-- Error Message -->
          <div *ngIf="errorMessage" class="mt-4 p-4 bg-red-50 border-l-4 border-red-500 rounded-r-lg">
            <div class="flex items-start gap-3">
              <svg class="w-5 h-5 text-red-500 flex-shrink-0 mt-0.5" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z"/>
              </svg>
              <p class="text-red-700 text-sm">{{ errorMessage }}</p>
            </div>
          </div>
        </form>

        <!-- Footer -->
        <div class="flex items-center justify-end gap-3 px-6 py-4 border-t border-gray-200 bg-gray-50">
          <button
            type="button"
            (click)="onClose()"
            class="px-5 py-2.5 border border-gray-300 rounded-lg hover:bg-white transition-colors font-medium text-gray-700">
            Cancel
          </button>
          <button
            type="button"
            (click)="onSubmit()"
            [disabled]="employeeForm.invalid || isSubmitting"
            class="px-5 py-2.5 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all font-medium shadow-sm hover:shadow-md">
            {{ isSubmitting ? 'Saving...' : (isEditMode ? 'Update Employee' : 'Create Employee') }}
          </button>
        </div>
      </div>
    </div>